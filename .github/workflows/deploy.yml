name: build and push

on:
  push:
    branches:
      - master

env:
  BACKEND_IMAGE_NAME: tsundoku-backend
  BACKEND_DOCKERFILE: Dockerfile.backend

jobs:
# build
# test
# push image

  build-and-push-image:
      runs-on: ubuntu-latest
      # needs: test 
      permissions: 
        contents: read
        packages: write 
      steps:
        - name: Checkout
          uses: actions/checkout@v2

        - name: Log in to GitHub Docker Registry
          uses: docker/login-action@v1
          with:
            registry: docker.pkg.github.com
            username: ${{ github.actor }}
            password: ${{ secrets.GITHUB_TOKEN }}

        - name: Build container image
          uses: docker/build-push-action@v2
          with:
            push: true
            file: ${BACKEND_DOCKERFILE}
            tags: docker.pkg.github.com/${{ github.repository }}/latest
